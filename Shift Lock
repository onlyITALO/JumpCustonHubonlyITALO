-- Remade by Roblue | Extra Compact ShiftLock

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")

local Player = Players.LocalPlayer

local ScreenGui = Instance.new("ScreenGui")
local Button = Instance.new("ImageButton")
local Cursor = Instance.new("ImageLabel")

local States = {
	Off = "rbxasset://textures/ui/mouseLock_off@2x.png",
	On  = "rbxasset://textures/ui/mouseLock_on@2x.png",
	Lock = "rbxasset://textures/MouseLockedCursor.png"
}

local MaxLength = 900000
local CamOffsetOn = CFrame.new(1.7, 0, 0)
local CamOffsetOff = CFrame.new(-1.7, 0, 0)

local ActiveConnection

-- GUI
ScreenGui.Name = "ShiftLock_UI"
ScreenGui.Parent = CoreGui
ScreenGui.ResetOnSpawn = false

-- BOT√ÉO (MINI, N√ÉO ENCOSTA NO PULO)
Button.Parent = ScreenGui
Button.BackgroundTransparency = 1
Button.AnchorPoint = Vector2.new(1, 1)
Button.Position = UDim2.new(0.995, 0, 0.995, 0) -- bem no cantinho
Button.SizeConstraint = Enum.SizeConstraint.RelativeXX
Button.Size = UDim2.new(0.028, 0, 0.028, 0) -- üî• menor ainda
Button.Image = States.Off

-- CURSOR CENTRAL
Cursor.Parent = ScreenGui
Cursor.BackgroundTransparency = 1
Cursor.AnchorPoint = Vector2.new(0.5, 0.5)
Cursor.Position = UDim2.new(0.5, 0, 0.435, 0)
Cursor.SizeConstraint = Enum.SizeConstraint.RelativeXX
Cursor.Size = UDim2.new(0.03, 0, 0.03, 0)
Cursor.Image = States.Lock
Cursor.Visible = false

-- FUN√á√ÉO
Button.MouseButton1Click:Connect(function()
	if not ActiveConnection then
		ActiveConnection = RunService.RenderStepped:Connect(function()
			local Char = Player.Character
			local Humanoid = Char and Char:FindFirstChildOfClass("Humanoid")
			local Root = Char and Char:FindFirstChild("HumanoidRootPart")
			local Cam = workspace.CurrentCamera

			if Humanoid and Root then
				Humanoid.AutoRotate = false
				Button.Image = States.On
				Cursor.Visible = true

				Root.CFrame = CFrame.new(
					Root.Position,
					Vector3.new(
						Cam.CFrame.LookVector.X * MaxLength,
						Root.Position.Y,
						Cam.CFrame.LookVector.Z * MaxLength
					)
				)

				Cam.CFrame = Cam.CFrame * CamOffsetOn
			end
		end)
	else
		local Char = Player.Character
		local Humanoid = Char and Char:FindFirstChildOfClass("Humanoid")

		if Humanoid then
			Humanoid.AutoRotate = true
		end

		Button.Image = States.Off
		Cursor.Visible = false
		workspace.CurrentCamera.CFrame *= CamOffsetOff

		ActiveConnection:Disconnect()
		ActiveConnection = nil
	end
end)
